<Specification version="1.0" type="Algorithm_Reference">
    <Meta>
        <Title>AAN Forward DCT Algorithm Specification</Title>
        <Context>JPEG Encoding, Forward DCT</Context>
        <Target_Language>JavaScript</Target_Language>
    </Meta>

    <Definitions>
        <Overview>
            The Forward DCT converts spatial domain pixel values into frequency domain coefficients.
            This implementation uses the AAN (Arai, Agui, Nakajima) algorithm for efficient computation.
        </Overview>
        <Coordinate_System>
            <Input>f(x, y) spatial domain values (0-255 or shifted -128..127)</Input>
            <Output>F(u, v) DCT coefficients</Output>
            <Block_Size>8x8 pixels</Block_Size>
        </Coordinate_System>
    </Definitions>

    <Algorithm name="AAN_1D_FDCT">
        <Description>
            1D Forward Discrete Cosine Transform using the Arai algorithm.
            Applied to rows then columns.
        </Description>

        <Inputs>
            <Variable name="x" type="Array" length="8" description="Input spatial samples" />
        </Inputs>

        <Constants>
            <Multipliers description="Rotation constants (C = cos(n*pi/16))">
                <Const name="C1">0.98078528</Const>
                <Const name="C2">0.92387953</Const>
                <Const name="C3">0.83146961</Const>
                <Const name="C4">0.70710678</Const>
                <Const name="C5">0.55557023</Const>
                <Const name="C6">0.38268343</Const>
                <Const name="C7">0.19509032</Const>
            </Multipliers>
            <Scale_Factors description="Post-scaling factors (S_i)">
                <Const name="S_0">1 / (2 * sqrt(2))</Const>
                <Const name="S_1">1 / (4 * C1)</Const>
                <Const name="S_2">1 / (4 * C2)</Const>
                <Const name="S_3">1 / (4 * C3)</Const>
                <Const name="S_4">1 / (4 * C4)</Const>
                <Const name="S_5">1 / (4 * C5)</Const>
                <Const name="S_6">1 / (4 * C6)</Const>
                <Const name="S_7">1 / (4 * C7)</Const>
            </Scale_Factors>
        </Constants>

        <Processing_Stages>
            <Stage number="1" description="Initial Butterfly (Spatial Combination)">
                <Equations>
                    tmp0 = x[0] + x[7]
                    tmp7 = x[0] - x[7]
                    tmp1 = x[1] + x[6]
                    tmp6 = x[1] - x[6]
                    tmp2 = x[2] + x[5]
                    tmp5 = x[2] - x[5]
                    tmp3 = x[3] + x[4]
                    tmp4 = x[3] - x[4]
                </Equations>
            </Stage>

            <Stage number="2" description="Even/Odd Split Additions">
                <Equations>
                    tmp10 = tmp0 + tmp3
                    tmp13 = tmp0 - tmp3
                    tmp11 = tmp1 + tmp2
                    tmp12 = tmp1 - tmp2
                    
                    // Odd part handling
                    z1 = tmp4 + tmp7
                    z2 = tmp5 + tmp6
                    z3 = tmp4 + tmp6
                    z4 = tmp5 + tmp7
                    z5 = (z3 + z4) * 1.175875602 // (C3-C7)? Check standard AAN
                </Equations>
            </Stage>
            
            <Stage number="3" description="Rotations and Further Additions">
                <Equations>
                    // Even Part
                    tmp0 = tmp10 + tmp11
                    tmp4 = tmp10 - tmp11
                    z1 = (tmp12 + tmp13) * 0.707106781 // C4
                    tmp2 = tmp13 + z1
                    tmp6 = tmp13 - z1
                    
                    // Odd Part
                    tmp5 = (z1 - z5) // Need to verify exact AAN flow here
                    // Using standard AAN flow from literature for FDCT
                </Equations>
            </Stage>
        </Processing_Stages>
        
        <Reference_Implementation_Note>
            Since the existing AAN-algo-spec.xml actually described the Forward DCT, 
            refer to that file for the exact butterfly equations if needed.
            This file serves as the formal declaration for the Forward DCT task.
        </Reference_Implementation_Note>
    </Algorithm>
</Specification>
