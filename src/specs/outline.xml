<project name="Ollie" description="A pure JavaScript JPEG Encoder implementation">
    <structure>
        <directory name="src">
            <file name="main.js" description="Entry point for the web interface. Handles file input, canvas manipulation, download button, and invokes the encoder." />
            <file name="jpeg-encoder.js" description="Main encoder class. Orchestrates the JPEG compression pipeline.">
                <class name="JpegEncoder">
                    <method name="constructor" params="quality=50" description="Initializes the encoder with quality setting." />
                    <method name="encode" params="imageData" return="Uint8Array" description="Encodes the provided ImageData (RGBA) into a JPEG byte array." />
                </class>
            </file>
            <file name="jpeg-decoder.js" description="Main decoder class. Orchestrates the JPEG decompression pipeline.">
                <class name="JpegDecoder">
                    <method name="constructor" description="Initializes the decoder." />
                    <method name="decode" params="jpegBytes" return="ImageData" description="Decodes a JPEG byte array into ImageData (RGBA)." />
                </class>
            </file>
            
            <directory name="core" description="Core algorithms and data structures for JPEG compression">
                <file name="colorspace.js" description="Converts RGB pixels to YCbCr color space.">
                    <function name="rgbToYcbcr" params="r, g, b" return="{y, cb, cr}" description="Converts RGB values (0-255) to YCbCr." />
                    <function name="ycbcrToRgb" params="y, cb, cr" return="{r, g, b}" description="Converts YCbCr values back to RGB (placeholder)." />
                </file>
                <file name="blocks.js" description="Handles image padding and extraction of 8x8 pixel blocks.">
                    <function name="padDimensions" params="width, height" return="{width, height}" description="Calculates new dimensions padded to multiples of 8." />
                    <function name="extractBlock" params="data, imgWidth, imgHeight, x, y" return="Float32Array(64)" description="Extracts an 8x8 block from the flattened image data." />
                </file>
                <file name="dct.js" description="Implements the Forward Discrete Cosine Transform (FDCT).">
                    <function name="forwardDCT" params="block" return="Float32Array(64)" description="Performs 2D FDCT on an 8x8 block." />
                </file>
                <file name="quantization.js" description="Defines quantization tables and applies quantization.">
                    <constant name="QUANTIZATION_TABLE_LUMA" type="Int32Array" />
                    <constant name="QUANTIZATION_TABLE_CHROMA" type="Int32Array" />
                    <function name="quantize" params="block, table" return="Int32Array(64)" description="Divides DCT coefficients by the quantization table." />
                </file>
                <file name="zigzag.js" description="Implements ZigZag reordering of quantized coefficients.">
                    <constant name="ZIGZAG_ORDER" type="Int32Array" />
                    <function name="zigZag" params="block" return="Int32Array(64)" description="Reorders 8x8 block into 1D array using ZigZag pattern." />
                </file>
                <file name="huffman.js" description="Implements Huffman entropy coding.">
                    <constant name="DC_LUMA_TABLE" type="Object" />
                    <constant name="AC_LUMA_TABLE" type="Object" />
                    <function name="computeCategory" params="val" return="number" description="Computes the SSSS category for a value." />
                    <function name="getBitRepresentation" params="val" return="number" description="Computes the bit representation of a value within its category." />
                    <function name="encodeBlock" params="block, previousDC, writer, dcTable, acTable" return="number" description="Encodes a single block using Huffman tables. Returns the new DC value." />
                </file>
            </directory>

            <directory name="decoder" description="Core algorithms for JPEG decoding">
                <file name="quantization-parser.js" description="Parses DQT segments and extracts quantization tables.">
                    <function name="parseQuantizationTable" params="data" return="Map<id, table>" description="Extracts quantization tables from DQT segment." />
                </file>
                <file name="huffman-parser.js" description="Parses DHT segments and builds Huffman decoding trees.">
                    <class name="HuffmanTable">
                        <method name="constructor" params="bits, values" description="Builds lookup table from BITS and HUFFVAL arrays." />
                        <method name="decode" params="bitReader" return="symbol" description="Decodes next symbol from bitstream." />
                    </class>
                    <function name="parseHuffmanTable" params="data" return="Map<id, HuffmanTable>" description="Extracts Huffman tables from DHT segment." />
                </file>
                <file name="frame-parser.js" description="Parses SOF0 frame header.">
                    <function name="parseFrameHeader" params="data" return="FrameInfo" description="Extracts image dimensions, components, and sampling factors." />
                </file>
                <file name="scan-parser.js" description="Parses SOS scan header.">
                    <function name="parseScanHeader" params="data" return="ScanInfo" description="Extracts scan parameters and component-to-table mappings." />
                </file>
                <file name="huffman-decoder.js" description="Decodes Huffman-encoded bitstream into quantized coefficients.">
                    <function name="decodeBlock" params="bitReader, dcTable, acTable, previousDC" return="{block, dc}" description="Decodes one 8x8 block of quantized coefficients." />
                    <function name="decodeDC" params="bitReader, table, previousDC" return="number" description="Decodes DC coefficient with differential coding." />
                    <function name="decodeAC" params="bitReader, table, block" description="Decodes AC coefficients with run-length encoding." />
                </file>
                <file name="inverse-zigzag.js" description="Converts 1D coefficient array to 8x8 2D block.">
                    <constant name="INVERSE_ZIGZAG_ORDER" type="Int32Array" />
                    <function name="inverseZigZag" params="array" return="Float32Array(64)" description="Reorders 1D array into 8x8 block." />
                </file>
                <file name="dequantization.js" description="Multiplies quantized coefficients by quantization table.">
                    <function name="dequantize" params="block, table" return="Float32Array(64)" description="Reverses quantization by multiplication." />
                </file>
                <file name="idct.js" description="Implements the Inverse Discrete Cosine Transform (IDCT).">
                    <function name="inverseDCT" params="block" return="Float32Array(64)" description="Performs 2D IDCT on an 8x8 block." />
                </file>
                <file name="colorspace-decoder.js" description="Converts YCbCr to RGB color space.">
                    <function name="ycbcrToRgb" params="y, cb, cr" return="{r, g, b}" description="Converts YCbCr values to RGB (0-255)." />
                </file>
                <file name="upsampling.js" description="Upsamples subsampled chroma components.">
                    <function name="upsample" params="component, hFactor, vFactor" return="Array" description="Upsamples component using bilinear interpolation." />
                </file>
                <file name="block-assembly.js" description="Assembles decoded 8x8 blocks into full image.">
                    <function name="assembleImage" params="blocks, width, height, components" return="ImageData" description="Combines blocks into final RGBA image." />
                </file>
            </directory>

            <directory name="utils" description="Utility helper classes">
                <file name="bit-writer.js" description="Helper class for writing variable-length bit sequences.">
                    <class name="BitWriter">
                        <method name="writeBits" params="data, length" description="Writes a sequence of bits." />
                        <method name="writeBit" params="bit" description="Writes a single bit." />
                        <method name="flush" return="Uint8Array" description="Flushes pending bits and returns the final byte array." />
                    </class>
                </file>
                <file name="bit-reader.js" description="Helper class for reading variable-length bit sequences from JPEG data.">
                    <class name="BitReader">
                        <method name="constructor" params="data" description="Initializes reader with byte array." />
                        <method name="readBit" return="number" description="Reads a single bit (0 or 1)." />
                        <method name="readBits" params="length" return="number" description="Reads 1-16 bits as an integer." />
                        <method name="peekBits" params="length" return="number" description="Looks ahead without consuming bits." />
                        <method name="alignToByte" description="Skips to next byte boundary." />
                    </class>
                </file>
                <file name="marker-parser.js" description="Parses JPEG file structure and extracts segments.">
                    <function name="findNextMarker" params="data, offset" return="{marker, offset}" description="Locates next 0xFFxx marker." />
                    <function name="readMarkerSegment" params="data, offset" return="{type, data, nextOffset}" description="Extracts segment payload." />
                    <function name="parseFileStructure" params="jpegBytes" return="SegmentMap" description="Builds map of all segments in file." />
                </file>

            </directory>

            <directory name="specs" description="Project documentation and specifications">
                <file name="outline.xml" description="Project structure and component overview (this file)." />
                <file name="test-outline.xml" description="Test suite structure and component overview." />
            </directory>
        </directory>

    </structure>
    <directory name="test" description="Test suite. See src/specs/test-outline.xml for detailed structure." />

    <pipeline>
        <step order="1" name="Preprocessing" description="Image data is padded to multiples of 8 and converted from RGB to YCbCr." />
        <step order="2" name="Block Processing" description="Image is processed in 8x8 blocks." />
        <step order="3" name="DCT" description="Forward DCT converts spatial data to frequency domain." />
        <step order="4" name="Quantization" description="Frequency coefficients are divided by quantization tables to reduce precision." />
        <step order="5" name="ZigZag" description="2D block is flattened to 1D array in zigzag order." />
        <step order="6" name="Entropy Coding" description="Run-length encoding and Huffman coding are applied." />
        <step order="7" name="File Assembly" description="Headers (SOI, DQT, SOF0, DHT, SOS) and scan data are combined into the final JPEG file." />
    </pipeline>
</project>
